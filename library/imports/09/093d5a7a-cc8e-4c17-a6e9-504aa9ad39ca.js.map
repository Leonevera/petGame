{"version":3,"sources":["..\\..\\..\\..\\..\\assets\\shop\\js/assets\\shop\\js\\shopCopy.js"],"names":["globalData","require","Commodity","id","name","categoryID","categoryName","price","_isShow","_isOwn","cartAmount","showCategory","isSelling","cc","Class","extends","Component","properties","commodityArray","cart","showedCommodityArray","selectedCommodityIndex","selectedCategory","selectedSubCategory","subCategory","Node","_isSubCateHidden","coin","Label","growthLevel","cost","shopListView","ScrollView","cateBtn1","Button","cateBtn2","cateBtn3","cateBtn4","subCateBtn1","subCateBtn2","subCateBtn3","subCateBtn4","subCateBtn5","subCateBtn6","subCateBtn7","exitBtn","prompt","_isPromptHidden","promptUnitPrice","get","_promptUnitPrice","set","value","promptUnitPriceLabel","string","promptQuantity","_promptQuantity","promptQuantityLabel","promptTotalPrice","_promptTotalPrice","promptTotalPriceLabel","promptShowPic","Sprite","promptExitBtn","promptCancelBtn","promptConfirmBtn","promptIncreaseBtn","promptDecreaseBtn","commodityShowBlock","Layout","cartSpriteArray","onClickCategory","event","active","console","log","target","modifyShopItemType","loadShopItem","onClickSubCategory","confirm","push","openPrompt","i","length","element","exit","showedCommodityArra","director","loadScene","goHome","promptItem","promptSp","action","node","spriteFrame","fin","fadeTo","runAction","scale","s","scaleTo","easing","easeBackOut","fout","fadeOut","easeBackIn","end_func","callFunc","bind","seq","sequence","onPromptDecreaseBtnClicked","onPromptIncreaseBtnClicked","initShop","_data","itemIDArray","split","itemNameArray","categoryIDArray","categoryNameArray","priceArray","index","commodity","type","self","destroyAllChildren","itemNum","picName","loader","loadRes","SpriteFrame","err","sp","Prefab","prf","commodityItem","instantiate","getComponent","init","on","zIndex","addChild","height","scrollToTop","onLoad","url","request","getXMLHttpRequest","response","open","sys","isNative","xhr","setRequestHeader","onreadystatechange","readyState","status","httpStatus","statusText","responseText","JSON","parse","send","start"],"mappings":"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","file":"shopCopy.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\shop\\js","sourcesContent":["/*\r\n  author: qll\r\n  time: 2019/12/2\r\n*/\r\n// 加载数据\r\nvar globalData = require(\"globalData\");\r\n\r\nfunction Commodity(id, name, categoryID, categoryName, price) {\r\n\tthis.id = id;\r\n\tthis.name = name;\r\n\tthis.categoryID = categoryID;\r\n\tthis.categoryName = categoryName;\r\n\tthis.price = price;\r\n\tthis._isShow = false;\r\n\tthis._isOwn = false; // 需要服务器传值才能确定，现在先按照单机的写\r\n\tthis.cartAmount = 0;\r\n\r\n\tthis.showCategory = function (categoryID) {\r\n\t\tif (this.categoryID == categoryID) {\r\n\t\t\tthis._isShow = true;\r\n\t\t} else {\r\n\t\t\tthis._isShow = false;\r\n\t\t}\r\n\t\tthis.isSelling();\r\n\t};\r\n\t// 判断是否商店是否继续销售\r\n\tthis.isSelling = function () {\r\n\t\tif (this._isOwn && ( this.categoryID != 1 && this.categoryID != 2) ) {\r\n\t\t\tthis._isShow = false;\r\n\t\t}\r\n\t};\r\n};\r\n\r\n\r\ncc.Class({\r\n\textends: cc.Component,\r\n\r\n\tproperties: {\r\n\t\tcommodityArray: [],  // 全部商品对象数组\r\n\t\tcart: [],  // 购物车中商品对象数组\r\n\t\tshowedCommodityArray: [],  // 框中展示出的商品对象数组\r\n\t\tselectedCommodityIndex: 0, // 选中的商品在商品数组中的序列\r\n\t\tselectedCategory: 0,//选定的类别ID\r\n\t\tselectedSubCategory: 0,//选定的子类别ID\r\n\r\n\t\tsubCategory: cc.Node, // 子类标签节点\r\n\t\t_isSubCateHidden: true,  //标志位：子类别标签是否隐藏\r\n\r\n\t\t//以下为对页面的控制数据\r\n\t\tcoin: cc.Label, //用户金币值\r\n\t\tgrowthLevel: cc.Label, //用户等级\r\n\t\t\r\n\t\tcost: cc.Label, //一次购买操作的花费\r\n\r\n\t\tshopListView: cc.ScrollView,\r\n\r\n\t\tcateBtn1: cc.Button, // 商品类别1按钮\r\n\t\tcateBtn2: cc.Button, // 商品类别2按钮\r\n\t\tcateBtn3: cc.Button, // 商品类别3按钮\r\n\t\tcateBtn4: cc.Button, // 商品类别4按钮\r\n\r\n\t\tsubCateBtn1: cc.Button, // 小屋装饰子类别1按钮\r\n\t\tsubCateBtn2: cc.Button, // 小屋装饰子类别2按钮\r\n\t\tsubCateBtn3: cc.Button, // 小屋装饰子类别3按钮\r\n\t\tsubCateBtn4: cc.Button, // 小屋装饰子类别4按钮\r\n\t\tsubCateBtn5: cc.Button, // 小屋装饰子类别5按钮\r\n\t\tsubCateBtn6: cc.Button, // 小屋装饰子类别6按钮\r\n\t\tsubCateBtn7: cc.Button, // 小屋装饰子类别7按钮\r\n\r\n\t\texitBtn: cc.Button, // 退出按钮\r\n\r\n\t\tprompt: cc.Node, // 提示框节点\r\n\t\t_isPromptHidden: true,  // 标志位：提示框是否隐藏\r\n\t\tpromptUnitPrice: { // 提示框显示单价\r\n\t\t\tget: function(){\r\n\t\t\t\treturn this._promptUnitPrice;\r\n\t\t\t},\r\n\t\t\tset: function(value) {\r\n\t\t\t\tthis._promptUnitPrice = value;\r\n\t\t\t\tthis.promptUnitPriceLabel.string = this._promptUnitPrice + '';\r\n\t\t\t}\r\n\t\t},\r\n\t\tpromptQuantity: { // 提示框显示数量\r\n\t\t\tget: function(){\r\n\t\t\t\treturn this._promptQuantity;\r\n\t\t\t},\r\n\t\t\tset: function(value) {\r\n\t\t\t\tif(value < 0) {\r\n\t\t\t\t\tvalue = 0;\r\n\t\t\t\t}\r\n\t\t\t\tthis._promptQuantity = value;\r\n\t\t\t\tthis.promptQuantityLabel.string = this._promptQuantity + '';\r\n\t\t\t}\r\n\t\t},\r\n\t\tpromptTotalPrice: { // 提示框显示总价\r\n\t\t\tget: function(){\r\n\t\t\t\treturn this._promptTotalPrice;\r\n\t\t\t},\r\n\t\t\tset: function() {\r\n\t\t\t\tthis._promptTotalPrice = this._promptUnitPrice * this.promptQuantity;\r\n\t\t\t\tthis.promptTotalPriceLabel.string = this._promptTotalPrice + '';\r\n\t\t\t}\r\n\t\t},\r\n\t\tpromptShowPic: cc.Sprite, // 提示框展示的商品图片\r\n\t\tpromptUnitPriceLabel: cc.Label, // 提示框单价显示标签\r\n\t\tpromptTotalPriceLabel: cc.Label, // 提示框总价显示标签\r\n\t\tpromptQuantityLabel: cc.Label, // 提示框数量显示标签\r\n\t\tpromptExitBtn: cc.Button, // 退出提示框按钮\r\n\t\tpromptCancelBtn: cc.Button, // 提示框取消按钮\r\n\t\tpromptConfirmBtn: cc.Button, // 提示框确认按钮\r\n\t\tpromptIncreaseBtn: cc.Button, // 提示框增加数量按钮\r\n\t\tpromptDecreaseBtn: cc.Button, // 提示框减少数量按钮\r\n\r\n\t\tcommodityShowBlock: cc.Layout, //商店中商品展示框\r\n\t\tcartSpriteArray: cc.Sprite * 25, //商店中展示的商品\r\n\r\n\t},\r\n\r\n\t//点击类别按钮的事件处理函数\r\n\tonClickCategory: function (event) {\r\n\t\tthis.subCategory.active = false;\r\n\t\tconsole.log('category ' + event.target.name + ' was clicked!');\r\n\t\tif (event.target.name == 'btn1') {\r\n\t\t\tthis.selectedCategory = 1;\r\n\t\t\tthis.modifyShopItemType(1);\r\n\t\t\tthis.loadShopItem();\r\n\t\t} else if (event.target.name == 'btn2') {\r\n\t\t\tthis.selectedCategory = 2;\r\n\t\t\tthis.modifyShopItemType(2);\r\n\t\t\tthis.loadShopItem();\r\n\t\t} else if (event.target.name == 'btn3') {\r\n\t\t\tthis.selectedCategory = 3;\r\n\t\t\tthis.modifyShopItemType(3);\r\n\t\t\tthis.loadShopItem();\r\n\t\t\tthis.subCategory.active = true;\r\n\t\t} else {\r\n\t\t\tthis.selectedCategory = 4;\r\n\t\t\tthis.modifyShopItemType(10);\r\n\t\t\tthis.loadShopItem();\r\n\t\t}\r\n\t},\r\n\r\n\t//点击子类别按钮的事件处理函数\r\n\tonClickSubCategory: function (event) {\r\n\t\tconsole.log('sub category ' + event.target.name + ' was clicked!');\r\n\t\tif (event.target.name == 'btn1') {\r\n\t\t\tthis.modifyShopItemType(3);\r\n\t\t\tthis.loadShopItem()\r\n\t\t} else if (event.target.name == 'btn2') {\r\n\t\t\tthis.modifyShopItemType(4);\r\n\t\t\tthis.loadShopItem();\r\n\t\t} else if (event.target.name == 'btn3') {\r\n\t\t\tthis.modifyShopItemType(5);\r\n\t\t\tthis.loadShopItem();\r\n\t\t} else if (event.target.name == 'btn4') {\r\n\t\t\tthis.modifyShopItemType(6);\r\n\t\t\tthis.loadShopItem();\r\n\t\t} else if (event.target.name == 'btn5') {\r\n\t\t\tthis.modifyShopItemType(7);\r\n\t\t\tthis.loadShopItem();\r\n\t\t} else if (event.target.name == 'btn6') {\r\n\t\t\tthis.modifyShopItemType(8);\r\n\t\t\tthis.loadShopItem();\r\n\t\t} else {\r\n\t\t\tthis.modifyShopItemType(9);\r\n\t\t\tthis.loadShopItem();\r\n\t\t}\r\n\t},\r\n\r\n\t//点击确认按钮的事件处理函数\r\n\tconfirm: function () {\r\n\t\tif (this.promptQuantity > 0) {\r\n\t\t\tconsole.log(\"buy \" + this.commodityArray[this.selectedCommodityIndex].name + ' ' + this.commodityArray[this.selectedCommodityIndex].cartAmount);\r\n\t\t\t// 选中商品的加入购物车\r\n\t\t\tthis.commodityArray[this.selectedCommodityIndex]._isOwn = true;\r\n\r\n\t\t\tthis.commodityArray[this.selectedCommodityIndex].cartAmount = this.promptQuantity;\r\n\t\t\tthis.commodityArray[this.selectedCommodityIndex].isSelling(); // 购买该商品之后重新判断能否出现在商店\r\n\t\t\tthis.cart.push(this.commodityArray[this.selectedCommodityIndex]);\r\n\t\t\tthis.openPrompt();\r\n\t\t\tthis.loadShopItem();\r\n\t\t}\r\n\t\tconsole.log(\"--------fellows are in cart--------\");\r\n\t\tfor (let i = 0; i < this.cart.length; i++) {\r\n\t\t\tconst element = this.cart[i];\r\n\t\t\tconsole.log(\"shop name: \" + element.name + \",amount: \" + element.cartAmount );\r\n\t\t}\r\n\r\n\t\t// let date = new Date();\r\n\t\t// let year = date.getFullYear(); //获取当前年份   \r\n\t\t// let month = date.getMonth() + 1; //获取当前月份   \r\n\t\t// let dat = date.getDate(); //获取当前日    \r\n\t\t// let hour = date.getHours(); //获取小时   \r\n\t\t// let minute = date.getMinutes(); //获取分钟   \r\n\t\t// let second = date.getSeconds(); //获取秒   \r\n\t\t// let timeStr = year + '-' + month + '-' + dat + ' ' + hour + ':' + minute + ':' + second;\r\n\t\t// var serverAddr = globalData.serverAddr.get() + \"php/buy.php\"; //服务器接口地址\r\n\t\t// var ins = this;\r\n\t\t// wx.request({\r\n\t\t// \turl: serverAddr,\r\n\t\t// \tmethod: \"POST\",\r\n\t\t// \theader: {\r\n\t\t// \t\t\"content-type\": \"application/x-www-form-urlencoded\"\r\n\t\t// \t},\r\n\t\t// \tdata: {\r\n\t\t// \t\tuserID: globalData.userID.get(),\r\n\t\t// \t\toperationTime: timeStr,\r\n\t\t// \t\tcategoryID: ins.selectedCommodity.categoryID,\r\n\t\t// \t\titemID: ins.selectedCommodity.itemID,\r\n\t\t// \t\tnumber: ins.number,\r\n\t\t// \t},\r\n\t\t// \tsuccess(res) {\r\n\t\t// \t\tglobalData.flagStory.set(res.data.flagStory);\r\n\t\t// \t\tglobalData.flagSkipping.set(res.data.flagSkipping);\r\n\t\t// \t\tins.cost.string = res.data.cost;\r\n\t\t// \t\tconsole.log(res.data);\r\n\t\t// \t\tlet title = \"花费:\" + res.data.cost;\r\n\t\t// \t\twx.showToast({\r\n\t\t// \t\t\ttitle: title,\r\n\t\t// \t\t\ticon: 'none',\r\n\t\t// \t\t\tduration: 3000\r\n\t\t// \t\t});\r\n\t\t// \t\t//退出提示框，恢复默认值\r\n\t\t// \t\tins.number.string = 1;\r\n\t\t// \t\tins.cost.string = 0;\r\n\t\t// \t\tins._isPromptHidden = true;\r\n\t\t// \t}\r\n\t\t// })\r\n\t},\r\n\r\n\r\n\t//点击关闭商店按钮的事件处理函数，返回主界面\r\n\texit: function () {\r\n\t\t//退出清空\r\n\t\tthis.cart = [];\r\n\t\tthis.showedCommodityArra = [];\r\n\t\tthis.selectedCategory = 0;\r\n\t\tthis.selectedSubCategory = 0;\r\n\t\tcc.director.loadScene(\"mainPage\");\r\n\t},\r\n\r\n\t//点击小屋按钮的事件处理函数，去到小屋\r\n\tgoHome: function () {\r\n\t\t//退出清空\r\n\t\tthis.cart = [];\r\n\t\tthis.showedCommodityArra = [];\r\n\t\tthis.selectedCategory = 0;\r\n\t\tthis.selectedSubCategory = 0;\r\n\t\tcc.director.loadScene(\"home\");\r\n\t},\r\n\r\n\t/**\r\n     * 打开或者关闭提示框\r\n     * @param {Commodity} promptItem 提示框显示的商品对象\r\n\t * @param {cc.SpriteFrame} promptSp 提示框显示的商品图片\r\n     */\r\n\topenPrompt: function (promptItem, promptSp) {\r\n\t\tthis._isPromptHidden = !this._isPromptHidden;\r\n\t\tlet action = null;\r\n\t\tif (this.selectedCategory == 1 || this.selectedCategory == 2) {\r\n\t\t\tthis.promptIncreaseBtn.node.active = true;\r\n\t\t\tthis.promptDecreaseBtn.node.active = true;\r\n\t\t} else {\r\n\t\t\tthis.promptIncreaseBtn.node.active = false;\r\n\t\t\tthis.promptDecreaseBtn.node.active = true;\r\n\t\t}\r\n\t\tif (!this._isPromptHidden) {\r\n\t\t\tconsole.log(\"open prompt\");\r\n\t\t\t// 将提示框的信息替换为点击的商品\r\n\t\t\tthis.promptUnitPrice = promptItem.price;\r\n\t\t\tthis.promptShowPic.spriteFrame = promptSp;\r\n\t\t\t// 初始购买值设为1\r\n\t\t\tthis.promptQuantity = 1;\r\n\t\t\tthis.promptTotalPrice = 0;\r\n\t\t\t// 打开购买提示框\r\n\t\t\tthis.prompt.active = true;\r\n\r\n\t\t\t// 提示框打开动作部分：\r\n\t\t\t// mask 渐变出来;\r\n\t\t\tvar fin = cc.fadeTo(0.3, 255);\r\n\t\t\tthis.prompt.runAction(fin);\r\n\t\t\t// dlg由小到大\r\n\t\t\tthis.prompt.scale = 0;\r\n\t\t\tvar s = cc.scaleTo(0.4, 1).easing(cc.easeBackOut());\r\n\t\t\tthis.prompt.runAction(s);\r\n\t\t} else {\r\n\t\t\tconsole.log(\"close prompt\");\r\n\t\t\t// 提示框关闭动作部分：\r\n\t\t\tvar fout = cc.fadeOut(0.3);\r\n\t\t\tthis.prompt.runAction(fout);\r\n\t\t\tvar s = cc.scaleTo(0.3, 0).easing(cc.easeBackIn());\r\n\t\t\tvar end_func = cc.callFunc(function() {\r\n\t\t\t\tthis.prompt.active = false;\r\n\t\t\t}.bind(this));\r\n\t\t\tvar seq = cc.sequence([s, end_func]);\r\n\t\t\tthis.prompt.runAction(seq);\r\n\t\t}\r\n\t\t// console.log(this.namePage.node);\r\n\t\tthis.prompt.runAction(action);\r\n\t},\r\n\r\n\t/**\r\n     * 提示框减少按钮被点击\r\n     */\r\n\tonPromptDecreaseBtnClicked: function () {\r\n\t\tthis.promptQuantity -= 1;\r\n\t\tthis.promptTotalPrice = 0;\r\n\t\tif (this.selectedCategory == 1 || this.selectedCategory == 2) {\r\n\t\t\tthis.promptIncreaseBtn.node.active = true;\r\n\t\t\tthis.promptDecreaseBtn.node.active = true;\r\n\t\t} else {\r\n\t\t\tthis.promptIncreaseBtn.node.active = true;\r\n\t\t\tthis.promptDecreaseBtn.node.active = false;\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n     * 提示框增加按钮被点击\r\n     */\r\n\tonPromptIncreaseBtnClicked: function () {\r\n\t\tthis.promptQuantity += 1;\r\n\t\tthis.promptTotalPrice = 0;\r\n\t\tif (this.selectedCategory == 1 || this.selectedCategory == 2) {\r\n\t\t\tthis.promptIncreaseBtn.node.active = true;\r\n\t\t\tthis.promptDecreaseBtn.node.active = true;\r\n\t\t} else {\r\n\t\t\tthis.promptIncreaseBtn.node.active = false;\r\n\t\t\tthis.promptDecreaseBtn.node.active = true;\r\n\t\t}\r\n\t},\r\n\r\n    /**\r\n     * 初始化商店信息\r\n     * @param {object} _data 服务器请求数据经过json转换后的对象\r\n     */\r\n\tinitShop: function (_data) {\r\n\t\tif (_data) {\r\n\t\t\tconsole.log( _data);\r\n\t\t\tlet itemIDArray = _data.itemIDArray.split('+');\r\n\t\t\tlet itemNameArray = _data.itemNameArray.split('+');\r\n\t\t\tlet categoryIDArray = _data.categoryIDArray.split('+');\r\n\t\t\tlet categoryNameArray = _data.categoryNameArray.split('+');\r\n\t\t\tlet priceArray = _data.priceArray.split('+');\r\n\t\t\tfor (let index = 0; index < itemIDArray.length; index++) {\r\n\t\t\t\tconst element = itemIDArray[index];\r\n\t\t\t\tlet commodity = new Commodity(itemIDArray[index], itemNameArray[index], categoryIDArray[index], categoryNameArray[index], priceArray[index]);\r\n\t\t\t\tcommodity.showCategory(1);\r\n\t\t\t\tthis.commodityArray.push(commodity);\r\n\t\t\t\t// console.log(commodity);\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n     * 修改商店加载商品类别\r\n     * @param { Number } type 加载商品类别 \r\n     */\r\n\tmodifyShopItemType: function(type) {\r\n\t\tconsole.log('commodity ' + type + ' will be loaded!');\r\n\t\tfor (let i = 0; i < this.commodityArray.length; i++) {\r\n\t\t\tconst element = this.commodityArray[i];\r\n\t\t\telement.showCategory(type);\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n     * 加载商店商品\r\n     * @param { Number } type 加载商品类别 \r\n     */\r\n\tloadShopItem: function () {\r\n\t\tlet self = this;\r\n\t\tself.commodityShowBlock.node.destroyAllChildren();\r\n\t\tlet itemNum = 0;\r\n\t\tfor (let i = 0; i < self.commodityArray.length; i++) {\r\n\t\t\tconst element = self.commodityArray[i];\r\n\t\t\tconsole.log(\"-----------debug log----------\");\r\n\t\t\tconsole.log(\"now load shop item: \" + i );\r\n\t\t\tif (element._isShow) {\r\n\t\t\t\titemNum += 1;\r\n\t\t\t\tconsole.log(\"item: \" + i + ' could be loaded');\r\n\t\t\t\tlet picName = element.id;\r\n\t\t\t\tcc.loader.loadRes(picName, cc.SpriteFrame, (err, sp) => {\r\n\t\t\t\t\tif (err) {\r\n\t\t\t\t\t\tconsole.log('failed to load sprite ' + picName);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tcc.loader.loadRes(\"prefab/shopItem\", cc.Prefab, (err, prf) => {\r\n\t\t\t\t\t\tif (err) {\r\n\t\t\t\t\t\t\tconsole.log('error: get prefab' + err + \"prefab/shopItem\");\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (!(prf instanceof cc.Prefab)) {\r\n\t\t\t\t\t\t\tconsole.log(\"not a prefab\");\r\n\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tlet commodityItem = cc.instantiate(prf);\r\n\t\t\t\t\t\tcommodityItem.getComponent('shopItem').init(element.price, sp);\r\n\t\t\t\t\t\tcommodityItem.on(\"touchstart\", function () {\r\n\t\t\t\t\t\t\tconsole.log(element.name + ' was clicked');\r\n\t\t\t\t\t\t\tself.selectedCommodityIndex = i;\r\n\t\t\t\t\t\t\tself.openPrompt(element, sp);\r\n\t\t\t\t\t\t\tconsole.log(self.commodityArray[self.selectedCommodityIndex].name + ' was clicked,order ' + i);\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t\tcommodityItem.zIndex = i;\r\n\t\t\t\t\t\tself.commodityShowBlock.node.addChild(commodityItem);\r\n\t\t\t\t\t\tconsole.log(self.commodityArray[i].name + ' is loading... item: ' + i);\r\n\t\t\t\t\t})\r\n\t\t\t\t\tconsole.log(\"item:\" + picName + \" load end\");\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t}\r\n\t\tself.commodityShowBlock.node.height = (itemNum % 3) ? ((itemNum - (itemNum % 3)) / 3 + 1) * 130 + (itemNum - (itemNum % 3)) / 3 * 20 : itemNum / 3  * 130 + itemNum  / 3 * 20;\r\n\t\tself.shopListView.scrollToTop(0.5);\r\n\t},\r\n\r\n\t// LIFE-CYCLE CALLBACKS:\r\n\r\n\tonLoad() {\r\n\r\n\t\t//初始化\r\n\t\t// this.growthLevel.string = globalData.growthLevel.get();\r\n\t\t// this.coin.string = globalData.coin.get();\r\n\t\t// this.number.string = 1;\r\n\t\t// this.cost.string = 1;\r\n\t\tthis.prompt.active = false;\r\n\t\tthis.selectedCategory = 1;\r\n\t\tthis.subCategory.active = false;\r\n\t\t//与服务器交互，获得所有的商品信息\r\n\t\tvar url = \"https://www.llquruc.top/petGame/\" + \"php/queryShop.php\"; //服务器接口地址\r\n\t\tvar request = cc.loader.getXMLHttpRequest();\r\n\t\tvar response = null;\r\n\t\tconsole.log(\"Status: Send Get Request to \" + url);\r\n\t\trequest.open(\"POST\", url, true); // param: 1,使用的HTTP方法， 2，请求的url, 3,异步吗？\r\n\t\tif (cc.sys.isNative) {\r\n\t\t\txhr.setRequestHeader(\"Accept-Encoding\", \"gzip,deflate\", \"text/html;charset=UTF-8\");\r\n\t\t}\r\n\t\tvar self = this;\r\n\t\trequest.onreadystatechange = function () {\r\n\t\t\tif (request.readyState == 4 && (request.status >= 200 && request.status <= 207)) {\r\n\t\t\t\tvar httpStatus = request.statusText;\r\n\t\t\t\tresponse = request.responseText;\r\n\t\t\t\tconsole.log(\"Status: Got GET response! \" + httpStatus);\r\n\t\t\t\tresponse = JSON.parse(response);\r\n\t\t\t\tconsole.log(response);\r\n\t\t\t\tself.initShop(response);\r\n\t\t\t\tself.loadShopItem();\r\n\t\t\t} else {\r\n\t\t\t\tconsole.log('failure');\r\n\t\t\t}\r\n\t\t};\r\n\t\trequest.send();\r\n\r\n\t},\r\n\r\n\tstart() {\r\n\r\n\t},\r\n\r\n\t// update (dt) {},\r\n});\r\n"]}