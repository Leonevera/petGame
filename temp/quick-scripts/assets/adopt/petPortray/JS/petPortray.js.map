{"version":3,"sources":["petPortray.js"],"names":["globalData","require","cc","Class","extends","Component","properties","speciesBtn","Button","skinBtn","genderBtn","nameBtn","portray","PageView","title","Label","curPage","speciesPage","ScrollView","genderPage","ToggleContainer","skinPage","namePage","Sprite","_isNamePageShow","onSpeciesBtnClicked","console","log","setCurrentPageIndex","scrollToPage","changeTitle","onGenderBtnClicked","onSkinBtnClicked","onNameBtnClicked","showNamePage","value","string","RangeError","pageNode","content","children","color","node","changeSpecies","species","sprite","getChildByName","getComponent","loader","loadRes","SpriteFrame","err","sp","spriteFrame","onScrollingEvent","i","items","length","element","worldPos","parent","convertToWorldSpaceAR","position","viewPos","convertToNodeSpaceAR","y","height","scale","onGenderToggleEvent","toggleArry","getComponentsInChildren","Toggle","isChecked","gender","onSkinToggleEvent","skin","onInputEvent","text","editbox","customEventData","name","petName","masterName","onCompleteClicked","director","loadScene","action","moveBy","v2","runAction","onLoad","start"],"mappings":"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","file":"petPortray.js","sourceRoot":"..\\..\\..\\..\\..\\..\\assets\\adopt\\petPortray\\JS","sourcesContent":["// Learn cc.Class:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/class.html\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/class.html\n// Learn Attribute:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\n//  - [English] https://www.cocos2d-x.org/docs/creator/manual/en/scripting/life-cycle-callbacks.html\n\nvar globalData = require('globalData');\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        speciesBtn: cc.Button, // 切换至物种选择页面\n        skinBtn: cc.Button, // 切换至毛色选择页面\n        genderBtn: cc.Button, // 切换至性别选择页面\n        nameBtn: cc.Button, // 切换至命名页面\n\n        portray: cc.PageView, // 整个页面\n        title: cc.Label, // 可改变页面标题\n        curPage: 0, \n\n        speciesPage: cc.ScrollView, // 物种选择页面\n        genderPage: cc.ToggleContainer, // 性别选择页面\n        skinPage: cc.ToggleContainer, // 毛色选择页面\n        namePage: cc.Sprite, // 命名页面\n        _isNamePageShow: false, // 是否显示命名页面\n        \n    },\n\n    // 监听button点击事件\n    onSpeciesBtnClicked: function() {\n        console.log('change to species view');\n        this.portray.setCurrentPageIndex(0);\n        this.portray.scrollToPage(0);\n        this.changeTitle(0);\n    },\n\n    onGenderBtnClicked: function() {\n        console.log('change to gender view');\n        this.portray.setCurrentPageIndex(1);\n        this.portray.scrollToPage(1);\n        this.changeTitle(1);\n    },\n\n    onSkinBtnClicked: function() {\n        console.log('change to skin view');\n        this.portray.setCurrentPageIndex(2);\n        this.portray.scrollToPage(2);\n        this.changeTitle(2);\n    },\n\n    onNameBtnClicked: function() {\n        console.log('change to name view');\n        this.showNamePage();\n    },\n\n    // 改变标题颜色及内容\n    changeTitle: function(value){\n        if (value == 0) {\n            this.title.string = \"宠物种类\";\n        } else if (value == 1) {\n            this.title.string = \"宠物性别\";\n        } else if (value == 2) {\n            this.title.string = \"宠物毛色\";\n        } else {\n            console.log(\"petPortray/function:changeTile wrong parameter\");\n            return RangeError\n        }\n        let pageNode = this.portray.content.children;\n        console.log(pageNode[value].color);\n        this.title.node.color = pageNode[value].color;\n    },\n    // 改变用户物种选择\n    changeSpecies: function(value){\n        if (value > 3 || value < 0) {\n            console.log(\"species value error\");\n            return RangeError;\n        }\n        globalData.species = value;\n        console.log(globalData);\n        // this.species = value;\n\n        // 修改skin页面的物种精灵\n        let sprite = this.portray.content.children[2].getChildByName(\"pickedPet\").getComponent(cc.Sprite);\n        console.log(sprite);\n        if (value == 0) {\n            console.log(\"user choose owl\");\n            cc.loader.loadRes(\"owl-simple\", cc.SpriteFrame, (err, sp) => {\n                console.log(err);\n                if (err) return;\n                if (this.node) {\n                    console.log(\"success\");\n                    if(sprite){\n                        sprite.spriteFrame = sp;\n                    }\n                }\n            })\n        } else if (value == 1) {\n            console.log(\"user choose penguin\");\n            cc.loader.loadRes(\"penguin-simple\", cc.SpriteFrame, (err, sp) => {\n                console.log(err);\n                if (err) return;\n                if (this.node) {\n                    console.log(\"success\");\n                    if(sprite){\n                        sprite.spriteFrame = sp;\n                    }\n                }\n            })\n        } else if (value == 2) {\n            console.log(\"user choose cat\");\n            cc.loader.loadRes(\"cat-simple\", cc.SpriteFrame, (err, sp) => {\n                console.log(err);\n                if (err) return;\n                if (this.node) {\n                    console.log(\"success\");\n                    if(sprite){\n                        sprite.spriteFrame = sp;\n                    }\n                }\n            })\n        } else if (value == 3) {\n            console.log(\"user choose dog\");\n            cc.loader.loadRes(\"dog-simple\", cc.SpriteFrame, (err, sp) => {\n                console.log(err);\n                if (err) return;\n                if (this.node) {\n                    console.log(\"success\");\n                    if(sprite){\n                        sprite.spriteFrame = sp;\n                    }\n                }\n            })\n        }    \n    },\n    // 监听物种选择页面的滚动事件，判断用户物种选择\n    onScrollingEvent: function(){\n        // console.log(this.speciesPage.getScrollOffset(), this.items[this.species]);\n        for (let i = 0; i < this.items.length; i++) {\n            const element = this.items[i];\n            let worldPos = element.parent.convertToWorldSpaceAR(element.position);\n            let viewPos = this.content.parent.convertToNodeSpaceAR(worldPos);\n            // console.log(element.name, this.content.getParent().name)\n            // console.log(worldPos, viewPos, this.speciesPage.node.convertToWorldSpaceAR(this.content.getParent().position));\n            \n            if (viewPos.y < element.height/2 && viewPos.y >= -element.height/2) {\n                // scroll滑动到相应的宠物种类时，进行处理\n                if (globalData.species != i) {\n                    // 判断滑动是否使种类发生改变，发生改变进行以下处理\n                    this.items[globalData.species].scale = 0.8;\n                    this.changeSpecies(i);\n                    this.items[globalData.species].scale = 1.25; \n                }     \n            } \n              \n        }\n\n        // console.log(this.content.height,this.speciesPage.getContentPosition());\n    },\n    // 监听性别选择页面的复选框事件\n    onGenderToggleEvent: function() {\n        let toggleArry = this.genderPage.getComponentsInChildren(cc.Toggle);\n        for (let i = 0; i < toggleArry.length; i++) {\n            const element = toggleArry[i];\n            if (element.isChecked) {\n                globalData.gender = i;\n                if (globalData.gender == 0) {\n                    console.log(\"user choose boy pet\");\n                } else {\n                    console.log(\"user choose girl pet\");\n                }\n            }\n        }\n    },\n    // 监听毛色选择页面的复选框事件\n    onSkinToggleEvent : function() {\n        let toggleArry = this.skinPage.getComponentsInChildren(cc.Toggle);\n        for (let i = 0; i < toggleArry.length; i++) {\n            const element = toggleArry[i];\n            if (element.isChecked) {\n                globalData.skin = i;\n                console.log(\"user choose skin\" + (i + 1) )\n            }\n        }\n    },\n    // 监听输入事件\n    // textChanged 事件的回调函数的参数模型\n    // onTextChanged: function(text, editbox, customEventData) {\n    //     // 这里的 text 表示 修改完后的 EditBox 的文本内容\n    //     // 这里 editbox 是一个 cc.EditBox 对象\n    //     // 这里的 customEventData 参数就等于你之前设置的 \"foobar\"\n    // }\n    onInputEvent: function(text, editbox, customEventData){\n        console.log(editbox);\n        if (editbox.node.name == 'petNameInput') {\n            globalData.petName = text;\n            console.log(\"user set pet name\", globalData.petName);\n        } else if(editbox.node.name == 'masterNameInput'){\n            globalData.masterName = text;\n            console.log(\"user set master name\", globalData.masterName);\n        }\n    },\n    onCompleteClicked: function() {\n        console.log('turn to main page');\n        cc.director.loadScene(\"mainPage\");\n    },\n    // 显示命名页面\n    showNamePage: function() {\n        this._isNamePageShow = !this._isNamePageShow;\n        let action = null;\n        if (this._isNamePageShow) {\n            action = cc.moveBy(0.5, cc.v2(0, -800));\n        } else {\n            action = cc.moveBy(0.5, cc.v2(0, 800));\n        }\n        // console.log(this.namePage.node);\n        this.namePage.node.runAction(action);\n    },\n\n    // LIFE-CYCLE CALLBACKS:\n\n    onLoad () {\n        this.content = this.speciesPage.content;\n        this.items = this.content.children;// content的四个子节点，四个宠物选项node\n\n        // ------- 初始化宠物选项 -------       \n        // 宠物种类\n        this.changeSpecies(0);\n        this.items[globalData.species].scale = 1.25;\n        this.changeTitle(0);\n\n        this._isNamePageShow = false;\n    },\n\n    start () {\n\n    },\n\n    // update (dt) {},\n});\n"]}