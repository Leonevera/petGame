{"version":3,"sources":["net.js"],"names":["HttpHelper","cc","Class","extends","Component","statics","properties","httpGet","url","callback","myGame","gameUi","onShowLockScreen","xhr","loader","getXMLHttpRequest","onreadystatechange","readyState","status","respone","responseText","rsp","JSON","parse","onHideLockScreen","withCredentials","open","sys","isNative","setRequestHeader","gameManager","getToken","timeout","send","httpPost","params","stringify","httpPostLogin","account","password","str","window","btoa"],"mappings":"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","file":"net.js","sourceRoot":"..\\..\\..\\..\\assets\\Global","sourcesContent":["// 网络请求处理\r\n// author：wang-c\r\n// \r\n\r\nconst HttpHelper = cc.Class({\r\n    extends: cc.Component,\r\n \r\n    statics: {\r\n    },\r\n \r\n    properties: {\r\n \r\n    },\r\n \r\n    /**\r\n     * get请求\r\n     * @param {string} url \r\n     * @param {function} callback \r\n     */\r\n    httpGet(url, callback) {\r\n        cc.myGame.gameUi.onShowLockScreen();\r\n        let xhr = cc.loader.getXMLHttpRequest();\r\n        xhr.onreadystatechange = function () {\r\n            // cc.log(\"Get: readyState:\" + xhr.readyState + \" status:\" + xhr.status);\r\n            if (xhr.readyState === 4 && xhr.status == 200) {\r\n                let respone = xhr.responseText;\r\n                let rsp = JSON.parse(respone);\r\n                cc.myGame.gameUi.onHideLockScreen();\r\n                callback(rsp);\r\n            } else if (xhr.readyState === 4 && xhr.status == 401) {\r\n                cc.myGame.gameUi.onHideLockScreen();\r\n                callback({status:401});\r\n            } else {\r\n                //callback(-1);\r\n            }\r\n \r\n \r\n        };\r\n        xhr.withCredentials = true;\r\n        xhr.open('GET', url, true);\r\n \r\n        if (cc.sys.isNative) {\r\n            xhr.setRequestHeader('Access-Control-Allow-Origin', '*');\r\n            xhr.setRequestHeader('Access-Control-Allow-Methods', 'GET, POST');\r\n            xhr.setRequestHeader('Access-Control-Allow-Headers', 'x-requested-with,content-type,authorization');\r\n            xhr.setRequestHeader(\"Content-Type\", \"application/json\");\r\n            xhr.setRequestHeader('Authorization', 'Bearer ' + cc.myGame.gameManager.getToken());\r\n            xhr.setRequestHeader('Authorization', 'Bearer ' + \"\");\r\n        }\r\n \r\n        // note: In Internet Explorer, the timeout property may be set only after calling the open()\r\n        // method and before calling the send() method.\r\n        xhr.timeout = 8000;// 8 seconds for timeout\r\n \r\n        xhr.send();\r\n    },\r\n \r\n    /**\r\n     * post请求\r\n     * @param {string} url \r\n     * @param {object} params \r\n     * @param {function} callback \r\n     */\r\n    httpPost(url, params, callback) {\r\n        cc.myGame.gameUi.onShowLockScreen();\r\n        let xhr = cc.loader.getXMLHttpRequest();\r\n        xhr.onreadystatechange = function () {\r\n            // cc.log('xhr.readyState=' + xhr.readyState + '  xhr.status=' + xhr.status);\r\n            if (xhr.readyState === 4 && xhr.status == 200) {\r\n                let respone = xhr.responseText;\r\n                let rsp = JSON.parse(respone);\r\n                cc.myGame.gameUi.onHideLockScreen();\r\n                callback(rsp);\r\n            } else {\r\n                callback(-1);\r\n            }\r\n        };\r\n        xhr.open('POST', url, true);\r\n        // if (cc.sys.isNative) {\r\n        xhr.setRequestHeader('Access-Control-Allow-Origin', '*');\r\n        xhr.setRequestHeader('Access-Control-Allow-Methods', 'GET, POST');\r\n        xhr.setRequestHeader('Access-Control-Allow-Headers', 'x-requested-with,content-type');\r\n        xhr.setRequestHeader(\"Content-Type\", \"application/json\");\r\n        xhr.setRequestHeader('Authorization', 'Bearer ' + cc.myGame.gameManager.getToken());\r\n        // }\r\n \r\n        // note: In Internet Explorer, the timeout property may be set only after calling the open()\r\n        // method and before calling the send() method.\r\n        xhr.timeout = 8000;// 8 seconds for timeout\r\n \r\n        xhr.send(JSON.stringify(params));\r\n    },\r\n \r\n    /**\r\n     * 登录专用\r\n     * @param {string} url \r\n     * @param {object} params \r\n     * @param {function} callback \r\n     * @param {string} account \r\n     * @param {string} password \r\n     */\r\n    httpPostLogin(url, params, callback, account, password) {\r\n        cc.myGame.gameUi.onShowLockScreen();\r\n        let xhr = cc.loader.getXMLHttpRequest();\r\n        xhr.onreadystatechange = function () {\r\n            // cc.log('xhr.readyState=' + xhr.readyState + '  xhr.status=' + xhr.status);\r\n            if (xhr.readyState === 4 && xhr.status == 200) {\r\n                let respone = xhr.responseText;\r\n                let rsp = JSON.parse(respone);\r\n                cc.myGame.gameUi.onHideLockScreen();\r\n                callback(rsp);\r\n            } else {\r\n                callback(-1);\r\n            }\r\n        };\r\n        xhr.open('POST', url, true);\r\n        xhr.setRequestHeader('Access-Control-Allow-Origin', '*');\r\n        xhr.setRequestHeader('Access-Control-Allow-Methods', 'GET, POST');\r\n        xhr.setRequestHeader('Access-Control-Allow-Headers', 'x-requested-with,content-type');\r\n        xhr.setRequestHeader(\"Content-Type\", \"application/json\");\r\n        let str = account + \"@\" + password;\r\n        xhr.setRequestHeader('Authorization', 'Basic' + ' ' + window.btoa(str));\r\n \r\n        xhr.timeout = 8000;// 8 seconds for timeout\r\n \r\n        xhr.send(JSON.stringify(params));\r\n \r\n    }\r\n});\r\n \r\nwindow.HttpHelper = new HttpHelper();"]}