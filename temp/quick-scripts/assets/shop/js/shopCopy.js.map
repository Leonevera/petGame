{"version":3,"sources":["shopCopy.js"],"names":["globalData","require","cc","Class","extends","Component","properties","commodityArray","cart","showedCommodityArray","selectedCategory","selectedSubCategory","selectedCommodity","_isPromptHidden","_isSubCateHidden","coin","Label","growthLevel","number","cost","cateBtn1","Button","cateBtn2","cateBtn3","cateBtn4","subCateBtn1","subCateBtn2","subCateBtn3","subCateBtn4","subCateBtn5","subCateBtn6","exitBtn","promptExitBtn","promptCancelBtn","promptConfirmBtn","promptIncreaseBtn","promptDecreaseBtn","commoditySpriteArray","Sprite","cartSpriteArray","onClickCategory","categoryID","showedCommodityArrayCopy","len","length","i","push","_isSubCatetHidden","defaultSubCategoryID","onClickSubCategory","onClickCommodity","commodityID","string","reduceNumber","wx","showToast","title","icon","duration","increaseNumber","cancel","confirm","date","Date","year","getFullYear","month","getMonth","dat","getDate","hour","getHours","minute","getMinutes","second","getSeconds","timeStr","serverAddr","get","ins","request","url","method","header","data","userID","operationTime","itemID","success","res","flagStory","set","flagSkipping","console","log","exit","showedCommodityArra","director","loadScene","goHome","onLoad","commodity","itemName","categoryName","price","ownFlag","picAddr","itemIDArray","split","itemNameArray","categoryIDArray","categoryNameArray","priceArray","ownFlagArray","commodityArrayCopy","newCommodity","defaultCategoryID","start"],"mappings":"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","file":"shopCopy.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\shop\\js","sourcesContent":["/*\r\n  author: qll\r\n  time: 2019/12/2\r\n*/\r\n// 加载数据\r\nvar globalData = require(\"globalData\");\r\n\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n      commodityArray : [],  //全部商品对象数组\r\n      cart : [],  //购物车中商品对象数组\r\n      showedCommodityArray : [],  //框中展示出的商品对象数组\r\n      selectedCategory : 0,//选定的类别ID\r\n      selectedSubCategory : 0,//选定的子类别ID\r\n      selectedCommodity : null, //选定的商品对象\r\n      _isPromptHidden: true,  //标志位：提示框是否隐藏\r\n      _isSubCateHidden: true,  //标志位：子类别标签是否隐藏\r\n      \r\n      //以下为对页面的控制数据\r\n      coin: cc.Label, //用户金币值\r\n      growthLevel: cc.Label, //用户等级\r\n\r\n      number : cc.Label, //购买数量\r\n      cost : cc.Label, //一次购买操作的花费\r\n\r\n      cateBtn1: cc.Button, // 商品类别1按钮\r\n      cateBtn2: cc.Button, // 商品类别2按钮\r\n      cateBtn3: cc.Button, // 商品类别3按钮\r\n      cateBtn4: cc.Button, // 商品类别4按钮\r\n\r\n      subCateBtn1: cc.Button, // 小屋装饰子类别1按钮\r\n      subCateBtn2: cc.Button, // 小屋装饰子类别2按钮\r\n      subCateBtn3: cc.Button, // 小屋装饰子类别3按钮\r\n      subCateBtn4: cc.Button, // 小屋装饰子类别4按钮\r\n      subCateBtn5: cc.Button, // 小屋装饰子类别5按钮\r\n      subCateBtn6: cc.Button, // 小屋装饰子类别6按钮\r\n\r\n      exitBtn: cc.Button, // 退出按钮\r\n\r\n      promptExitBtn: cc.Button, // 退出提示框按钮\r\n      promptCancelBtn: cc.Button, // 提示框取消按钮\r\n      promptConfirmBtn: cc.Button, // 提示框确认按钮\r\n      promptIncreaseBtn: cc.Button, // 提示框增加数量按钮\r\n      promptDecreaseBtn: cc.Button, // 提示框减少数量按钮\r\n\r\n      commoditySpriteArray: cc.Sprite * 25, //商店中展示的商品\r\n      cartSpriteArray: cc.Sprite * 25, //商店中展示的商品\r\n      \r\n    },\r\n\r\n    //点击类别按钮的事件处理函数\r\n    onClickCategory: function(categoryID){\r\n      this.selectedCategory = categoryID;\r\n      let showedCommodityArrayCopy = [];\r\n      if(categoryID == 1 || categoryID == 2  || categoryID == 10){  //普通商品没有子分类\r\n        let len = this.commodityArray.length;\r\n        for (let i=0; i<len; i++)\r\n        {\r\n          if (this.commodityArray[i].categoryID == categoryID)\r\n          {\r\n            showedCommodityArrayCopy.push(commodityArray[i]);\r\n          }      \r\n        }\r\n      }\r\n      else{\r\n        this._isSubCatetHidden = false;//子分类显现     \r\n        let defaultSubCategoryID = 3;   //小屋装饰有子分类，需要设置默认子分类\r\n        let len = this.commodityArray.length;\r\n        for (let i=0; i<len; i++)\r\n        {\r\n          if (this.commodityArray[i].categoryID == defaultSubCategoryID)\r\n          {\r\n            showedCommodityArrayCopy.push(commodityArray[i]);\r\n          }      \r\n        }\r\n      }\r\n      this.showedCommodityArray = showedCommodityArrayCopy;\r\n    },\r\n\r\n    //点击子类别按钮的事件处理函数\r\n    onClickSubCategory: function(categoryID){\r\n      let showedCommodityArrayCopy = [];\r\n      let len = this.commodityArray.length;\r\n      for (let i=0; i<len; i++)\r\n      {\r\n        if (this.commodityArray[i].categoryID == categoryID)\r\n        {\r\n          showedCommodityArrayCopy.push(commodityArray[i]);\r\n        }      \r\n      }\r\n      this.selectedSubCategory = categoryID;\r\n      this.showedCommodityArray = showedCommodityArrayCopy;\r\n    },\r\n\r\n    //点击商品按钮的事件处理函数\r\n    onClickCommodity: function(commodityID){\r\n      this.selectedCommodity = this.commodityArray[commodityID];\r\n      this._isPromptHidden = false;  //提示框显现\r\n      //设置弹出框中的一些默认值\r\n      this.number.string = 1;\r\n      this.cost.string = 0;\r\n    },\r\n\r\n    //点击减少数量按钮的事件处理函数\r\n    reduceNumber: function(){\r\n      if(this.number.string != 0){\r\n        this.number.string = this.number.string - 1;\r\n      }\r\n      else{\r\n        wx.showToast({\r\n          title: '不能再减啦~~',\r\n          icon: 'none',\r\n          duration: 3000\r\n        });\r\n      }\r\n    },\r\n\r\n    //点击增加数量按钮的事件处理函数\r\n    increaseNumber: function(){\r\n      if (this.selectedCommodity.categoryID == 1 || this.selectedCommodity.categoryID == 2){   //只有食品和洗澡用品可以买多个\r\n        this.number.string = this.number.string + 1;\r\n      }\r\n      else{\r\n        wx.showToast({\r\n          title: '同一个小屋装饰只能买一个哟~',\r\n          icon: 'none',\r\n          duration: 3000\r\n        });\r\n      }\r\n      \r\n    },\r\n\r\n    //点击取消或者退出按钮的事件处理函数\r\n    cancel: function(){\r\n      //退出提示框，恢复默认值\r\n      this.number.string = 1;\r\n      this._isPromptHidden = true;\r\n    },\r\n\r\n    //点击确认按钮的事件处理函数\r\n    confirm: function(){\r\n      let date = new Date();   \r\n\t\t  let year = date.getFullYear(); //获取当前年份   \r\n\t\t  let month = date.getMonth()+1; //获取当前月份   \r\n\t\t  let dat = date.getDate(); //获取当前日    \r\n\t\t  let hour = date.getHours(); //获取小时   \r\n\t\t  let minute = date.getMinutes(); //获取分钟   \r\n\t\t  let second = date.getSeconds(); //获取秒   \r\n      let timeStr = year + '-' + month + '-' + dat + ' ' + hour + ':' + minute + ':' + second;\r\n      var serverAddr = globalData.serverAddr.get() + \"php/buy.php\"; //服务器接口地址\r\n      var ins = this;\r\n      wx.request({\r\n        url: serverAddr,\r\n        method: \"POST\",\r\n        header: {\r\n          \"content-type\": \"application/x-www-form-urlencoded\"\r\n        },\r\n        data: {  \r\n          userID : globalData.userID.get(),\r\n          operationTime : timeStr,\r\n          categoryID : ins.selectedCommodity.categoryID,\r\n          itemID : ins.selectedCommodity.itemID,\r\n          number : ins.number,\r\n        },\r\n        success(res) {\r\n          globalData.flagStory.set(res.data.flagStory);\r\n          globalData.flagSkipping.set(res.data.flagSkipping);\r\n          ins.cost.string = res.data.cost;\r\n          console.log(res.data);\r\n          let title = \"花费:\" + res.data.cost;\r\n          wx.showToast({\r\n            title: title,\r\n            icon: 'none',\r\n            duration: 3000\r\n          });\r\n          //退出提示框，恢复默认值\r\n          ins.number.string = 1;\r\n          ins.cost.string = 0;\r\n          ins._isPromptHidden = true;\r\n        }\r\n      })\r\n    },\r\n\r\n\r\n    //点击关闭商店按钮的事件处理函数，返回主界面\r\n    exit: function(){\r\n      //退出清空\r\n      this.cart = [];\r\n      this.showedCommodityArra = [];\r\n      this.selectedCategory = 0;\r\n      this.selectedSubCategory = 0;\r\n      cc.director.loadScene(\"mainPage\");\r\n    },\r\n\r\n    //点击小屋按钮的事件处理函数，去到小屋\r\n    goHome: function(){\r\n      //退出清空\r\n      this.cart = [];\r\n      this.showedCommodityArra = [];\r\n      this.selectedCategory = 0;\r\n      this.selectedSubCategory = 0;\r\n      cc.director.loadScene(\"home\");\r\n    },\r\n\r\n    // LIFE-CYCLE CALLBACKS:\r\n\r\n    onLoad () {\r\n      \r\n      //初始化\r\n      this.growthLevel.string = globalData.growthLevel.get();\r\n      this.coin.string = globalData.coin.get();\r\n      this.number.string = 1;\r\n      this.cost.string = 1;\r\n\r\n      //函数：创建商品对象\r\n      function commodity(commodityID, itemID, itemName, categoryID, categoryName, price, ownFlag){\r\n        this.commodityID = commodityID;\r\n        this.itemID = itemID;\r\n        this.itemName = itemName;\r\n        this.categoryID = categoryID;\r\n        this.categoryName = categoryName;\r\n        this.price = price;\r\n        this.ownFlag = ownFlag;\r\n        this.picAddr = globalData.serverAddr.get() + 'material/shopPic/' + categoryID + '/' + itemID;\r\n        console.log(this);\r\n      }\r\n\r\n      //与服务器交互，获得所有的商品信息\r\n      var serverAddr = globalData.serverAddr.get() + \"php/queryShop.php\"; //服务器接口地址\r\n      wx.request({\r\n        url: serverAddr,\r\n        method: \"POST\",\r\n        header: {\r\n          \"content-type\": \"application/x-www-form-urlencoded\"\r\n        },\r\n        data: {  \r\n          \r\n        },\r\n        success(res) {\r\n          //成功获得返回后，执行以下语句\r\n          let itemIDArray = res.data.itemIDArray.split(\"+\");\r\n          delete itemIDArray[0];\r\n          let itemNameArray = res.data.itemNameArray.split(\"+\");\r\n          delete itemNameArray[0];\r\n          let categoryIDArray = res.data.categoryIDArray.split(\"+\");\r\n          delete categoryIDArray[0];\r\n          let categoryNameArray = res.data.categoryNameArray.split(\"+\");\r\n          delete categoryNameArray[0];\r\n          let priceArray = res.data.priceArray.split(\"+\");\r\n          delete priceArray[0];\r\n          let ownFlagArray = res.data.ownFlagArray.split(\"+\");\r\n          delete ownFlagArray[0];\r\n\r\n          //设置最开始进入页面时，默认展示食品类别商品\r\n          let commodityArrayCopy = [];         \r\n          let len = itemIDArray.length;\r\n          for (let i=0; i<len; i++)\r\n          {\r\n            let newCommodity = new commodity(i, itemIDArray[i], itemNameArray[i], categoryIDArray[i], categoryNameArray[i], priceArray[i], ownFlagArray[i]);\r\n            commodityArrayCopy.push(newCommodity);\r\n          }\r\n          this.commodityArray = commodityArrayCopy;\r\n          console.log(res.data);\r\n          let showedCommodityArrayCopy = [];\r\n          len = this.commodityArray.length;\r\n          let defaultCategoryID = 1;\r\n          for (let i=0; i<len; i++)\r\n          {\r\n            if (this.commodityArray[i].categoryID == defaultCategoryID)\r\n            {\r\n              showedCommodityArrayCopy.push(commodityArray[i]);\r\n            }      \r\n          }\r\n          this.showedCommodityArray = showedCommodityArrayCopy;\r\n          this.selectedCategory = defaultCategoryID;\r\n        }\r\n      })\r\n\r\n      \r\n      \r\n      \r\n      \r\n    },\r\n\r\n    start () {\r\n\r\n    },\r\n\r\n    // update (dt) {},\r\n});\r\n"]}